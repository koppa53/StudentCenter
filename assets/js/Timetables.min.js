!(function (e) {
    var t = function (e) {
        (this.el = document.querySelector(e.el)),
            (this.Timetables = e.timetables || []),
            (this.week = e.week || []),
            (this.merge = "boolean" != typeof e.merge || e.merge),
            (this.TimetableType = e.timetableType || []),
            (this.leftHandText = []),
            (this.highlightWeek = e.highlightWeek || ""),
            (this.gridOnClick = "function" == typeof e.gridOnClick ? e.gridOnClick : void 0);
        var t = e.styles || {};
        (this.leftHandWidth = t.leftHandWidth || 40),
            (this.Gheight = t.Gheight || 48),
            (this.defaultPalette = ["#45AAF2","#4B7BEC","#A65EEA","#778CA3","#2D98DA","#3867D6","#8854D0","#A5B1C2","#4B6584","#45AAF2","#4B7BEC","#A65EEA","#778CA3","#2D98DA","#3867D6","#8854D0","#A5B1C2","#4B6584"]),
            (this.palette = !("boolean" == typeof t.palette && !t.palett) && (t.palette || []).concat(this.defaultPalette)),
            this._init(); //["#f05261", "#48a8e4", "#ffd061", "#52db9a", "#70d3e6", "#52db9a", "#3f51b5", "#f3d147", "#4adbc3", "#673ab7", "#f3db49", "#76bfcd", "#b495e1", "#ff9800", "#8bc34a"])
    };
    (t.prototype = {
        _init: function (e) {
            var t,
                n = (e = e || {}).styles || {},
                i = e.gridOnClick || this.gridOnClick,
                l = "boolean" == typeof e.merge ? e.merge : this.merge,
                a = e.highlightWeek || this.highlightWeek,
                s = this.leftHandText,
                o = n.leftHandWidth || this.leftHandWidth,
                h = n.Gheight || this.Gheight;
            t = !("boolean" == typeof n.palette && !n.palette) && (n.palette ? (n.palette || []).concat(this.defaultPalette) : this.palette);
            var r = e.timetables || this.Timetables,
                d = e.week || this.week,
                c = JSON.parse(JSON.stringify(e.timetableType || this.TimetableType)),
                f = e.timetableType || this.TimetableType,
                p = c.length;
            r.forEach(function (e, t) {
                if (e.length < p) for (var n = 0; n < p - e.length; n++) e.push("");
            }),
                e.setNewOption && this.el.removeChild(this.el.childNodes[0]);
            var m = document.createElement("div");
            (m.id = "courseWrapper"),
                (m.style.position = "relative"),
                (m.style.paddingLeft = o + "px"),
                (m.style.border = "1px solid #dbdbdb"),
                c.forEach(function (e, t) {
                    e.unshift(t + 1);
                });
            var u = document.createElement("div");
            (u.className = "Courses-leftHand"), (u.style.position = "absolute"), (u.style.left = 0), (u.style.top = 0), (u.style.width = o + "px");
            var g = r[0].map(function (e, t) {
                return [];
            });
            g.forEach(function (e, t) {
                r.forEach(function (e, n) {
                    g[t].push(e[t]);
                });
            });
            var y = [];
            l &&
                r.forEach(function (e, t) {
                    y[t] || (y[t] = []),
                        e.forEach(function (e, n) {
                            if (!n) return y[t].push({ name: e, length: 1 });
                            if (e === (y[t][n - 1] || {}).name && e) {
                                var i = (y[t][n - 1] || {}).sameIndex;
                                return i || 0 === i ? (y[t][i].length++, y[t].push({ name: e, length: 0, sameIndex: i })) : (y[t][n - 1].length++, y[t].push({ name: e, length: 0, sameIndex: n - 1 }));
                            }
                            return y[t].push({ name: e, length: 1 });
                        });
                });
            var b = document.createElement("div");
            (b.style.overflow = "hidden"),
                (b.className = "Courses-head"),
                d.forEach(function (e, t) {
                    var n = document.createElement("div"),
                        i = a === t + 1 ? "highlight-week " : "";
                    (n.className = i + "Courses-head-" + (t + 1)),
                        (n.innerText = e),
                        (n.style.cssFloat = "left"),
                        (n.style.boxSizing = "border-box"),
                        (n.style.whiteSpace = "nowrap"),
                        (n.style.width = 100 / d.length + "%"),
                        b.appendChild(n);
                }),
                m.appendChild(b);
            var v = document.createElement("div");
            v.className = "Courses-content";
            var x = 0;
            g.forEach(function (e, n) {
                var a = document.createElement("ul");
                (a.style.listStyle = "none"),
                    (a.style.padding = "0px"),
                    (a.style.margin = "0px"),
                    (a.style.minHeight = h + "px"),
                    (a.className = "stage_" + ((c[0] || [])[0] || "none")),
                    --(c[0] || [])[2],
                    (c[0] || [])[2] || c.shift(),
                    e.forEach(function (e, s) {
                        if (!(s > d.length - 1)) {
                            var o = document.createElement("li");
                            if (((o.style.cssFloat = "left"), (o.style.width = 100 / d.length + "%"), (o.style.height = h + "px"), (o.style.boxSizing = "border-box"), (o.style.position = "relative"), l && y[s][n].length > 1)) {
                                var r = document.createElement("span");
                                (r.style.position = "absolute"),
                                    (r.style.zIndex = 9),
                                    (r.style.width = "100%"),
                                    (r.style.height = h * y[s][n].length + "px"),
                                    (r.style.left = 0),
                                    (r.style.top = 0),
                                    t && ((r.style.backgroundColor = t[x]), (r.style.color = "#fff"), ++x > t.length && (x = 0)),
                                    (r.innerText = y[s][n].name),
                                    (r.className = "course-hasContent"),
                                    o.appendChild(r);
                            } else
                                l && 0 === y[s][n].length
                                    ? (o.innerText = "")
                                    : (e && t ? ((o.style.backgroundColor = t[x]), (o.style.color = "#fff"), ++x > t.length && (x = 0)) : e && (o.className = "course-hasContent"), (o.innerText = e || ""));
                            (o.onclick = function (t) {
                                document.querySelectorAll(".Courses-content ul li").forEach(function (e, t) {
                                    e.classList.remove("grid-active");
                                });
                                this.className = "grid-active";
                                var a = { name: e, week: d[s], index: n + 1, length: l ? y[s][n].length : 1 };
                                i && i(a);
                            }),
                                a.appendChild(o);
                        }
                    }),
                    v.appendChild(a);
            }),
                m.appendChild(v),
                m.appendChild(u),
                this.el.appendChild(m);
            var C = (document.querySelector(".stage_1 li") || document.querySelector(".stage_none li")).offsetHeight,
                E = document.querySelector(".Courses-head").offsetHeight,
                T = document.createElement("div");
            (T.className = "left-hand-TextDom"),
                (T.style.height = E + "px"),
                (T.style.boxSizing = "border-box"),
                s.forEach(function (e) {
                    var t = document.createElement("div");
                    (t.innerText = e), T.appendChild(t);
                }),
                u.appendChild(T),
                f.forEach(function (e, t) {
                    var n = document.createElement("div");
                    if (((n.style.width = "100%"), (n.style.height = C * e[1] + "px"), (n.style.boxSizing = "border-box"), "object" == typeof e[0]))
                        for (var i in e[0]) {
                            var l = document.createElement("p");
                            (l.innerText = e[0][i]), (l.style.margin = "0px"), (l.className = "left-hand-" + i), n.appendChild(l);
                        }
                    else n.innerText = e[0] || "";
                    (n.className = "left-hand-" + (t + 1)), u.appendChild(n);
                });
        },
        setOption: function (e) {
            ((e || {}).setNewOption = !0), this._init(e);
        },
    }),
        "undefined" != typeof module && module.exports && (module.exports = t),
        "function" == typeof define &&
            define(function () {
                return t;
            }),
        (e.Timetables = t);
})(this);
